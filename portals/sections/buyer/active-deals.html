<!-- My Active Deals Section -->
<section id="my-deals" class="py-16 bg-white dark:bg-slate-800">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-slate-900 dark:text-white">My Active Deals</h2>
                <div class="flex gap-4">
                    <label for="deal-filter" class="sr-only">Filter deals by phase</label>
                    <select id="deal-filter" class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-900 dark:text-white" aria-label="Filter deals by phase">
                        <option value="all">All Deals</option>
                        <option value="phase1">Phase 1: Discovery</option>
                        <option value="phase2">Phase 2: Evaluation</option>
                        <option value="phase3">Phase 3: Due Diligence</option>
                        <option value="phase4">Phase 4: Closing</option>
                    </select>
                    <button type="button" class="bg-accent hover:bg-accent-dark text-white font-medium py-2 px-4 rounded-md transition-colors">
                        Start New Deal
                    </button>
                </div>
            </div>

            <!-- Active Deals List -->
            <div id="active-deals-list" class="space-y-6">
                <!-- Deals will be populated by JavaScript -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-12">
                <div class="text-6xl mb-4">ðŸ“‹</div>
                <h3 class="text-xl font-semibold text-slate-900 dark:text-white mb-2">No Active Deals</h3>
                <p class="text-slate-600 dark:text-slate-300 mb-6">Start browsing Express Listings to begin your first deal</p>
                <button class="bg-accent hover:bg-accent-dark text-white font-medium py-3 px-6 rounded-md transition-colors">
                    Browse Express Listings
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Active Deals JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sample active deals data
    const sampleDeals = [
        {
            id: 1,
            businessName: "DFW Collision Center",
            location: "Fort Worth, TX",
            dealSize: 1200000,
            phase: 3,
            phaseName: "Due Diligence",
            startedDays: 18,
            daysRemaining: 16,
            progress: 53,
            status: "on-track",
            nextAction: "Continue DD",
            timeline: "Express Deal Timeline"
        },
        {
            id: 2,
            businessName: "Quick Lube Express",
            location: "Dallas, TX",
            dealSize: 450000,
            phase: 2,
            phaseName: "Evaluation",
            startedDays: 8,
            daysRemaining: 26,
            progress: 24,
            status: "on-track",
            nextAction: "Submit LOI",
            timeline: "Express Deal Timeline"
        },
        {
            id: 3,
            businessName: "Elite Transmission Specialists",
            location: "Arlington, TX",
            dealSize: 650000,
            phase: 4,
            phaseName: "Closing",
            startedDays: 30,
            daysRemaining: 4,
            progress: 88,
            status: "urgent",
            nextAction: "Final Review",
            timeline: "Express Deal Timeline"
        }
    ];

    // Active Deals utilities
    window.ActiveDeals = {
        currentDeals: sampleDeals,

        // Format currency
        formatCurrency: function(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        },

        // Get phase color
        getPhaseColor: function(phase) {
            const colors = {
                1: 'bg-blue-100 text-blue-800',
                2: 'bg-green-100 text-green-800',
                3: 'bg-yellow-100 text-yellow-800',
                4: 'bg-purple-100 text-purple-800'
            };
            return colors[phase] || 'bg-slate-100 text-slate-800';
        },

        // Get status color
        getStatusColor: function(status) {
            const colors = {
                'on-track': 'bg-green-500',
                'urgent': 'bg-red-500',
                'delayed': 'bg-yellow-500'
            };
            return colors[status] || 'bg-slate-500';
        },

        // Create deal card HTML
        createDealCard: function(deal) {
            return `
                <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-6 border border-slate-200 dark:border-slate-600">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <h3 class="text-xl font-semibold text-slate-900 dark:text-white mr-3">${deal.businessName}</h3>
                                <span class="text-xs font-medium px-2.5 py-0.5 rounded ${this.getPhaseColor(deal.phase)}">
                                    Phase ${deal.phase}: ${deal.phaseName}
                                </span>
                            </div>
                            <p class="text-slate-600 dark:text-slate-300 mb-2">${deal.location} â€¢ Deal Size: ${this.formatCurrency(deal.dealSize)}</p>
                            <div class="flex items-center text-sm text-slate-500 dark:text-slate-400">
                                <span class="mr-4">Started: ${deal.startedDays} days ago</span>
                                <span class="mr-4">Days Remaining: ${deal.daysRemaining}</span>
                                <span>${deal.timeline}</span>
                            </div>
                        </div>
                        <div class="mt-4 lg:mt-0 lg:ml-6">
                            <div class="flex gap-3">
                                <button onclick="window.ActiveDeals.continueAction(${deal.id})" class="bg-primary-dark hover:bg-primary text-white font-medium py-2 px-4 rounded-md transition-colors">
                                    ${deal.nextAction}
                                </button>
                                <button onclick="window.ActiveDeals.viewTimeline(${deal.id})" class="bg-slate-600 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                                    View Timeline
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="mt-4">
                        <div class="flex justify-between text-sm text-slate-600 dark:text-slate-400 mb-2">
                            <span>Express Deal Progress</span>
                            <span>${deal.progress}% Complete</span>
                        </div>
                        <div class="bg-slate-200 dark:bg-slate-600 h-2 rounded-full">
                            <div class="h-2 rounded-full ${this.getStatusColor(deal.status)}" data-progress="${deal.progress}"></div>
                        </div>
                    </div>

                    <!-- Deal Timeline Phases -->
                    <div class="mt-6 grid grid-cols-4 gap-2">
                        ${[1, 2, 3, 4].map(phase => `
                            <div class="text-center">
                                <div class="w-8 h-8 mx-auto rounded-full flex items-center justify-center text-sm font-bold mb-1 ${
                                    phase <= deal.phase
                                        ? 'bg-accent text-white'
                                        : 'bg-slate-200 dark:bg-slate-600 text-slate-500'
                                }">
                                    ${phase}
                                </div>
                                <div class="text-xs text-slate-500 dark:text-slate-400">
                                    ${['Discovery', 'Evaluation', 'Due Diligence', 'Closing'][phase - 1]}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        },

        // Render deals
        renderDeals: function(deals = null) {
            const container = document.getElementById('active-deals-list');
            const emptyState = document.getElementById('empty-state');
            const dealsToShow = deals || this.currentDeals;

            if (dealsToShow.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                container.innerHTML = dealsToShow.map(deal => this.createDealCard(deal)).join('');
                emptyState.classList.add('hidden');
            }
        },

        // Filter deals
        filterDeals: function(filterType) {
            let filtered = [...this.currentDeals];

            if (filterType !== 'all') {
                const phaseMap = {
                    'phase1': 1,
                    'phase2': 2,
                    'phase3': 3,
                    'phase4': 4
                };
                const targetPhase = phaseMap[filterType];
                if (targetPhase) {
                    filtered = filtered.filter(deal => deal.phase === targetPhase);
                }
            }

            this.renderDeals(filtered);
        },

        // Continue action
        continueAction: function(dealId) {
            const deal = this.currentDeals.find(d => d.id === dealId);
            if (deal) {
                window.PortalUtils.showNotification(`Continuing ${deal.nextAction} for ${deal.businessName}...`, 'info');
                // Simulate navigation to specific action
                setTimeout(() => {
                    window.location.href = `#deal-${dealId}-action`;
                }, 1000);
            }
        },

        // View timeline
        viewTimeline: function(dealId) {
            const deal = this.currentDeals.find(d => d.id === dealId);
            if (deal) {
                window.PortalUtils.showNotification(`Opening timeline for ${deal.businessName}...`, 'info');
                // Simulate opening timeline modal or page
                setTimeout(() => {
                    window.location.href = `#deal-${dealId}-timeline`;
                }, 1000);
            }
        },

        // Initialize
        init: function() {
            this.renderDeals();

            // Set up filter
            const filterSelect = document.getElementById('deal-filter');
            filterSelect.addEventListener('change', (e) => {
                this.filterDeals(e.target.value);
            });
        }
    };

    // Initialize when loaded
    window.ActiveDeals.init();
});
</script>
