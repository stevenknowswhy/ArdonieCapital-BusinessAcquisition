<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//images.unsplash.com">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Listings - Ardonie Capital</title>
    <meta name="description" content="Browse available auto repair shops for sale in the Dallas-Fort Worth area. Find your perfect business opportunity with Ardonie Capital's Express Path program.">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../favicon.ico">

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="../assets/css/tailwind.css">

    <!-- Theme System -->
    <script>
        // Initialize tailwind config with theme support
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#3B82F6',
                            DEFAULT: '#2563EB',
                            dark: '#1D4ED8'
                        },
                        secondary: {
                            light: '#F8FAFC',
                            DEFAULT: '#E2E8F0',
                            dark: '#64748B'
                        },
                        accent: {
                            light: '#10B981',
                            DEFAULT: '#059669',
                            dark: '#047857'
                        }
                    }
                }
            }
        };

        // Apply saved theme preference immediately to prevent flash
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>


    <!-- Custom CSS -->
    <link rel="stylesheet" media="print" onload="this.media='all'" href="../assets/css/common.css">

    <!-- Security Headers -->
    <script src="../assets/js/security-headers.js" defer></script>

    

    

    <!-- Intersection Observer Polyfill for older browsers -->
    <script>
        if (!('IntersectionObserver' in window)) {
            const script = document.createElement('script');
            script.src = 'https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver';
            document.head.appendChild(script);
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Navigation Styles -->
    <link rel="stylesheet" href="../components/navigation-styles.css">
    <link rel="stylesheet" href="../assets/css/admin-navigation.css">

    <!-- Enhanced Marketplace Styles -->
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        #business-details-modal {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .favorite-heart {
            transition: all 0.2s ease;
        }

        .favorite-heart:hover {
            transform: scale(1.1);
        }

        .listing-card {
            transition: all 0.3s ease;
        }

        .listing-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="font-sans text-slate-800 bg-slate-50 dark:bg-slate-900 dark:text-slate-200">
    <!-- Header -->
        <!-- Navigation Component -->
    <div id="main-navigation-container"></div>
    <div id="admin-navigation-container"></div>

    <div class="flex">
        <!-- Filters Sidebar -->
        <div class="w-80 bg-white dark:bg-slate-800 shadow-sm border-r border-slate-200 dark:border-slate-700 h-screen overflow-y-auto">
            <div class="p-6">
                <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Filter Listings</h2>

                <!-- Search -->
                <div class="mb-6">
                    <label for="search-input" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Search</label>
                    <input type="text" id="search-input" placeholder="Search businesses..." class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                    <input type="text" id="search-input" placeholder="Search businesses..." class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                </div>

                <!-- Express Sellers Toggle -->
                <div class="mb-6">
                    <label class="flex items-center">
                        <input type="checkbox" id="express-only" class="text-primary focus:ring-primary rounded">
                        <span class="ml-2 text-sm font-medium text-slate-700 dark:text-slate-300">Express Sellers Only</span>
                    </label>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Show only businesses with expedited sale process</p>
                </div>

                <!-- Business Type -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">Business Type</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" name="business-type" value="Full Service Auto Repair" class="text-primary focus:ring-primary rounded">
                            <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Full Service Auto Repair</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="business-type" value="Transmission Repair" class="text-primary focus:ring-primary rounded">
                            <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Transmission Repair</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="business-type" value="Quick Service" class="text-primary focus:ring-primary rounded">
                            <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Quick Service</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="business-type" value="Collision Repair" class="text-primary focus:ring-primary rounded">
                            <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Collision Repair</span>
                        </label>
                    </div>
                </div>

                <!-- Price Range -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">Price Range</label>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="price-min" class="block text-xs text-slate-500 dark:text-slate-400 mb-1">Min Price</label>
                            <input type="number" id="price-min" placeholder="0" min="0" step="1000" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                        </div>
                        <div>
                            <label for="price-max" class="block text-xs text-slate-500 dark:text-slate-400 mb-1">Max Price</label>
                            <input type="number" id="price-max" placeholder="∞" min="0" step="1000" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                        </div>
                    </div>
                    <div class="mt-2 flex flex-wrap gap-1 text-xs">
                        <button type="button" onclick="document.getElementById('price-min').value=''; document.getElementById('price-max').value='500000'; window.enhancedMarketplace?.applyFilters()" class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600">Under $500K</button>
                        <button type="button" onclick="document.getElementById('price-min').value='500000'; document.getElementById('price-max').value='1000000'; window.enhancedMarketplace?.applyFilters()" class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600">$500K-$1M</button>
                        <button type="button" onclick="document.getElementById('price-min').value='1000000'; document.getElementById('price-max').value=''; window.enhancedMarketplace?.applyFilters()" class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600">Over $1M</button>
                    </div>
                </div>

                <!-- Location -->
                <div class="mb-6">
                    <label for="location-filter" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Location</label>
                    <select id="location-filter" data-filter="location" name="location" aria-label="Filter by location" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                        <option value="all">All DFW Area</option>
                        <option value="Dallas">Dallas</option>
                        <option value="Fort Worth">Fort Worth</option>
                        <option value="Plano">Plano</option>
                        <option value="Arlington">Arlington</option>
                        <option value="Irving">Irving</option>
                        <option value="Garland">Garland</option>
                        <option value="Mesquite">Mesquite</option>
                    </select>
                </div>

                <!-- Revenue Range -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Annual Revenue</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="revenue" class="text-primary focus:ring-primary">
                            <span class="ml-2 text-sm text-slate-600 dark:text-slate-300">$300K - $500K</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="revenue" class="text-primary focus:ring-primary">
                            <span class="ml-2 text-sm text-slate-600 dark:text-slate-300">$500K - $1M</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="revenue" class="text-primary focus:ring-primary">
                            <span class="ml-2 text-sm text-slate-600 dark:text-slate-300">$1M - $2M</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="revenue" class="text-primary focus:ring-primary">
                            <span class="ml-2 text-sm text-slate-600 dark:text-slate-300">$2M+</span>
                        </label>
                    </div>
                </div>

                <!-- Express Seller Filter -->
                <div class="mb-6">
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded border-slate-300 text-accent focus:ring-accent">
                        <span class="ml-2 text-sm text-slate-600 dark:text-slate-300">🚖 Express Sellers Only</span>
                    </label>
                </div>

                <!-- Clear Filters -->
                <button type="button" onclick="ExpressListingsSupabase.clearFilters()" class="w-full bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 py-2 px-4 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600 transition-all">
                    Clear All Filters
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Business Listings</h1>
                    <p id="results-count" class="text-slate-600 dark:text-slate-300">Loading listings...</p>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Save Search Alert Button -->
                    <button type="button" id="save-search-alert-btn"
                        class="flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition-colors"
                        title="Save current search as alert">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5v-12h0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 0V1m0 6l4-4M9 7L5 3"/>
                        </svg>
                        Save Alert
                    </button>

                    <label for="sort-select" class="sr-only">Sort listings</label>
                    <select id="sort-select" name="sort" aria-label="Sort listings" class="px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                        <option value="newest">Sort by: Newest</option>
                        <option value="oldest">Oldest First</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="revenue-high">Revenue: High to Low</option>
                        <option value="revenue-low">Revenue: Low to High</option>
                    </select>
                    <div class="flex border border-slate-300 dark:border-slate-600 rounded-md">
                        <button type="button" aria-label="Grid view" title="Grid view" class="p-2 bg-primary text-white rounded-l-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                            </svg>
                        </button>
                        <button type="button" aria-label="List view" title="List view" class="p-2 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-r-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Listings Grid -->
            <div id="listings-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Dynamic listings will be loaded here -->
                <div class="col-span-full text-center py-12">
                    <div class="animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
                    <p class="text-slate-600 dark:text-slate-300">Loading listings...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div class="mt-8 flex justify-center">
                <nav class="flex items-center space-x-2">
                    <button type="button" class="px-3 py-2 text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200" aria-label="Go to previous page">Previous</button>
                    <button type="button" class="px-3 py-2 text-sm bg-primary text-white rounded" aria-label="Current page 1" aria-current="page">1</button>
                    <button type="button" class="px-3 py-2 text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200" aria-label="Go to page 2">2</button>
                    <button type="button" class="px-3 py-2 text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200" aria-label="Go to page 3">3</button>
                    <button type="button" class="px-3 py-2 text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200" aria-label="Go to next page">Next</button>
                </nav>
            </div>
        </div>
    </div>

    <!-- Business Details Modal -->
    <div id="business-details-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4 hidden">
        <div class="modal-content bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-emerald-600 rounded-lg flex items-center justify-center mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 id="modal-business-name" class="text-2xl font-bold text-slate-900 dark:text-white">Business Name</h2>
                        <p id="modal-business-location" class="text-slate-600 dark:text-slate-300 mt-1">Location</p>
                    </div>
                </div>
                <button type="button" id="close-details-modal" aria-label="Close business details modal" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="flex flex-col lg:flex-row max-h-[calc(90vh-80px)]">
                <!-- Left Side - Images and Gallery -->
                <div class="lg:w-1/2 bg-slate-50 dark:bg-slate-700">
                    <div class="relative h-64 lg:h-full">
                        <img id="modal-main-image" src="" alt="Business Image" class="w-full h-full object-cover">
                        <div class="absolute top-4 right-4 flex gap-2">
                            <div id="modal-badges-container" class="flex flex-wrap gap-2">
                                <!-- Dynamic badges will be inserted here -->
                            </div>
                        </div>
                        <button type="button" id="modal-favorite-btn" aria-label="Add to favorites" title="Add to favorites" class="absolute top-4 left-4 p-3 bg-white/90 dark:bg-slate-800/90 rounded-full hover:bg-white dark:hover:bg-slate-800 transition-all shadow-lg">
                            <svg class="w-5 h-5 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Right Side - Business Information -->
                <div class="lg:w-1/2 overflow-y-auto">
                    <div class="p-6 space-y-6">
                        <!-- Key Metrics -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-4">
                                <div class="text-sm text-slate-600 dark:text-slate-400">Asking Price</div>
                                <div id="modal-asking-price" class="text-2xl font-bold text-slate-900 dark:text-white">$0</div>
                            </div>
                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-4">
                                <div class="text-sm text-slate-600 dark:text-slate-400">Annual Revenue</div>
                                <div id="modal-revenue" class="text-2xl font-bold text-slate-900 dark:text-white">$0</div>
                            </div>
                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-4">
                                <div class="text-sm text-slate-600 dark:text-slate-400">Cash Flow</div>
                                <div id="modal-cash-flow" class="text-2xl font-bold text-emerald-600">$0</div>
                            </div>
                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-4">
                                <div class="text-sm text-slate-600 dark:text-slate-400">ROI</div>
                                <div id="modal-roi" class="text-2xl font-bold text-blue-600">0%</div>
                            </div>
                        </div>

                        <!-- Business Description -->
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">About This Business</h3>
                            <p id="modal-description" class="text-slate-600 dark:text-slate-300 leading-relaxed">Business description will appear here...</p>
                        </div>

                        <!-- Business Details -->
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Business Details</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex justify-between py-2 border-b border-slate-200 dark:border-slate-600">
                                    <span class="text-slate-600 dark:text-slate-400">Business Type</span>
                                    <span id="modal-business-type" class="font-medium text-slate-900 dark:text-white">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-slate-200 dark:border-slate-600">
                                    <span class="text-slate-600 dark:text-slate-400">Established</span>
                                    <span id="modal-established" class="font-medium text-slate-900 dark:text-white">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-slate-200 dark:border-slate-600">
                                    <span class="text-slate-600 dark:text-slate-400">Employees</span>
                                    <span id="modal-employees" class="font-medium text-slate-900 dark:text-white">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-slate-200 dark:border-slate-600">
                                    <span class="text-slate-600 dark:text-slate-400">Square Footage</span>
                                    <span id="modal-square-footage" class="font-medium text-slate-900 dark:text-white">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Key Features -->
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Key Features</h3>
                            <div id="modal-features-container" class="flex flex-wrap gap-2">
                                <!-- Dynamic features will be inserted here -->
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Seller Information</h3>
                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-emerald-600 rounded-full flex items-center justify-center mr-3">
                                        <span id="modal-seller-initials" class="text-white font-semibold">--</span>
                                    </div>
                                    <div>
                                        <div id="modal-seller-name" class="font-semibold text-slate-900 dark:text-white">Seller Name</div>
                                        <div id="modal-seller-company" class="text-sm text-slate-600 dark:text-slate-400">Company</div>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <button type="button" id="modal-contact-btn" class="flex-1 bg-gradient-to-r from-blue-500 to-emerald-600 hover:from-blue-600 hover:to-emerald-700 text-white py-3 px-6 rounded-lg font-semibold transition-all duration-300">
                                        Contact Seller
                                    </button>
                                    <button type="button" id="modal-schedule-btn" class="flex-1 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 py-3 px-6 rounded-lg font-semibold transition-colors">
                                        Schedule Tour
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Marketplace System -->
    <script>
        // Enhanced Marketplace Listings with View Details Modal and Favorites
        class EnhancedMarketplace {
            constructor() {
                this.listings = [];
                this.filteredListings = [];
                this.favorites = this.loadFavorites();
                this.currentFilters = {
                    search: '',
                    businessTypes: [],
                    priceMin: null,
                    priceMax: null,
                    location: 'All DFW Area',
                    revenue: null,
                    expressOnly: false
                };
                this.currentSort = 'newest';
                this.currentPage = 1;
                this.itemsPerPage = 9;

                this.init();
            }

            init() {
                this.loadSampleData();
                this.setupEventListeners();
                this.renderListings();
                this.updateResultsCount();
            }

            loadSampleData() {
                // Enhanced sample data with more details for modal
                this.listings = [
                    {
                        id: 1,
                        name: "Premier Auto Service Center",
                        type: "Full Service Auto Repair",
                        location: "Plano, TX",
                        askingPrice: 850000,
                        cashFlow: 285000,
                        revenue: 1200000,
                        description: "Established full-service auto repair shop with loyal customer base and modern equipment. This business has been serving the Plano community for over 15 years with exceptional service and competitive pricing. The shop features state-of-the-art diagnostic equipment, 8 service bays, and a team of ASE-certified technicians.",
                        image: "https://images.unsplash.com/photo-1632823469850-1b7b1e8b7e1e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=200&q=80",
                        badges: ["express-seller"],
                        dateAdded: new Date('2024-01-15'),
                        featured: true,
                        established: 2008,
                        employees: 12,
                        squareFootage: 8500,
                        features: ["ASE Certified Technicians", "Modern Equipment", "Loyal Customer Base", "Prime Location", "Established Reputation"],
                        seller: {
                            name: "Michael Johnson",
                            company: "Johnson Automotive Group",
                            initials: "MJ"
                        }
                    },
                    {
                        id: 2,
                        name: "Elite Transmission Specialists",
                        type: "Transmission Repair",
                        location: "Arlington, TX",
                        askingPrice: 650000,
                        cashFlow: 195000,
                        revenue: 850000,
                        description: "Specialized transmission repair shop with 25+ years in business and excellent reputation. This niche business has built a strong reputation for quality transmission repairs and rebuilds, serving both retail customers and other auto shops in the DFW area.",
                        image: "https://images.unsplash.com/photo-1486754735734-325b5831c3ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=200&q=80",
                        badges: ["hot-deal"],
                        dateAdded: new Date('2024-01-10'),
                        featured: false,
                        established: 1998,
                        employees: 8,
                        squareFootage: 6000,
                        features: ["Transmission Specialists", "25+ Years Experience", "Excellent Reputation", "Niche Market", "Warranty Program"],
                        seller: {
                            name: "Robert Smith",
                            company: "Smith Transmission",
                            initials: "RS"
                        }
                    },
                    {
                        id: 3,
                        name: "Quick Lube Express",
                        type: "Quick Service",
                        location: "Fort Worth, TX",
                        askingPrice: 425000,
                        cashFlow: 145000,
                        revenue: 680000,
                        description: "High-volume quick lube and basic maintenance shop in prime location with excellent visibility. This business specializes in oil changes, basic maintenance, and state inspections with a focus on speed and customer convenience.",
                        image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=200&q=80",
                        badges: ["express-seller", "high-volume"],
                        dateAdded: new Date('2024-01-08'),
                        featured: true,
                        established: 2015,
                        employees: 6,
                        squareFootage: 3500,
                        features: ["High Volume", "Prime Location", "Quick Service", "State Inspections", "Excellent Visibility"],
                        seller: {
                            name: "Sarah Davis",
                            company: "Davis Auto Services",
                            initials: "SD"
                        }
                    },
                    {
                        id: 4,
                        name: "Precision Collision Center",
                        type: "Collision Repair",
                        location: "Dallas, TX",
                        askingPrice: 950000,
                        cashFlow: 320000,
                        revenue: 1450000,
                        description: "Premium collision repair center with insurance partnerships and state-of-the-art equipment. This business has established relationships with major insurance companies and uses the latest paint booth and frame straightening technology.",
                        image: "https://images.unsplash.com/photo-1609630875171-b1321377ee65?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=200&q=80",
                        badges: ["premium"],
                        dateAdded: new Date('2024-01-05'),
                        featured: false,
                        established: 2010,
                        employees: 15,
                        squareFootage: 12000,
                        features: ["Insurance Partnerships", "State-of-the-art Equipment", "Paint Booth", "Frame Straightening", "I-CAR Certified"],
                        seller: {
                            name: "David Wilson",
                            company: "Wilson Collision",
                            initials: "DW"
                        }
                    }
                ];

                this.filteredListings = [...this.listings];
            }

            setupEventListeners() {
                // Search functionality
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.currentFilters.search = e.target.value;
                        this.applyFilters();
                    });
                }

                // Express sellers toggle
                const expressToggle = document.getElementById('express-only');
                if (expressToggle) {
                    expressToggle.addEventListener('change', (e) => {
                        this.currentFilters.expressOnly = e.target.checked;
                        this.applyFilters();
                    });
                }

                // Price range filters
                const priceMinInput = document.getElementById('price-min');
                const priceMaxInput = document.getElementById('price-max');
                if (priceMinInput) {
                    priceMinInput.addEventListener('input', (e) => {
                        this.currentFilters.priceMin = e.target.value ? parseInt(e.target.value) : null;
                        this.applyFilters();
                    });
                }
                if (priceMaxInput) {
                    priceMaxInput.addEventListener('input', (e) => {
                        this.currentFilters.priceMax = e.target.value ? parseInt(e.target.value) : null;
                        this.applyFilters();
                    });
                }

                // Business type checkboxes
                const businessTypeCheckboxes = document.querySelectorAll('input[name="business-type"]');
                businessTypeCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.currentFilters.businessTypes = Array.from(businessTypeCheckboxes)
                            .filter(cb => cb.checked)
                            .map(cb => cb.value);
                        this.applyFilters();
                    });
                });

                // Location filter
                const locationSelect = document.getElementById('location-filter');
                if (locationSelect) {
                    locationSelect.addEventListener('change', (e) => {
                        this.currentFilters.location = e.target.value;
                        this.applyFilters();
                    });
                }

                // Sort functionality
                const sortSelect = document.getElementById('sort-select');
                if (sortSelect) {
                    sortSelect.addEventListener('change', (e) => {
                        this.currentSort = e.target.value;
                        this.applySorting();
                    });
                }

                // Modal event listeners
                const closeModalBtn = document.getElementById('close-details-modal');
                if (closeModalBtn) {
                    closeModalBtn.addEventListener('click', () => this.closeDetailsModal());
                }

                // Modal background click
                const modal = document.getElementById('business-details-modal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeDetailsModal();
                    });
                }

                // Modal favorite button
                const modalFavoriteBtn = document.getElementById('modal-favorite-btn');
                if (modalFavoriteBtn) {
                    modalFavoriteBtn.addEventListener('click', () => {
                        const listingId = modalFavoriteBtn.dataset.listingId;
                        if (listingId) this.toggleFavorite(parseInt(listingId));
                    });
                }

                // Modal contact and schedule buttons
                const modalContactBtn = document.getElementById('modal-contact-btn');
                const modalScheduleBtn = document.getElementById('modal-schedule-btn');
                if (modalContactBtn) {
                    modalContactBtn.addEventListener('click', () => {
                        const listingId = modalContactBtn.dataset.listingId;
                        if (listingId) this.contactSeller(parseInt(listingId));
                    });
                }
                if (modalScheduleBtn) {
                    modalScheduleBtn.addEventListener('click', () => {
                        const listingId = modalScheduleBtn.dataset.listingId;
                        if (listingId) this.scheduleTour(parseInt(listingId));
                    });
                }

                // Save Search Alert button
                const saveSearchAlertBtn = document.getElementById('save-search-alert-btn');
                if (saveSearchAlertBtn) {
                    saveSearchAlertBtn.addEventListener('click', () => {
                        this.showSaveSearchAlertModal();
                    });
                }
            }

            applyFilters() {
                this.filteredListings = this.listings.filter(listing => {
                    // Search filter
                    if (this.currentFilters.search) {
                        const searchTerm = this.currentFilters.search.toLowerCase();
                        const searchableText = `${listing.name} ${listing.type} ${listing.location} ${listing.description}`.toLowerCase();
                        if (!searchableText.includes(searchTerm)) return false;
                    }

                    // Express sellers filter
                    if (this.currentFilters.expressOnly) {
                        if (!listing.badges.includes('express-seller')) return false;
                    }

                    // Price range filter
                    if (this.currentFilters.priceMin && listing.askingPrice < this.currentFilters.priceMin) return false;
                    if (this.currentFilters.priceMax && listing.askingPrice > this.currentFilters.priceMax) return false;

                    // Business type filter
                    if (this.currentFilters.businessTypes.length > 0) {
                        if (!this.currentFilters.businessTypes.includes(listing.type)) return false;
                    }

                    // Location filter
                    if (this.currentFilters.location !== 'All DFW Area') {
                        if (!listing.location.includes(this.currentFilters.location)) return false;
                    }

                    return true;
                });

                this.applySorting();
            }

            applySorting() {
                this.filteredListings.sort((a, b) => {
                    switch (this.currentSort) {
                        case 'price-low':
                            return a.askingPrice - b.askingPrice;
                        case 'price-high':
                            return b.askingPrice - a.askingPrice;
                        case 'revenue-high':
                            return b.revenue - a.revenue;
                        case 'revenue-low':
                            return a.revenue - b.revenue;
                        case 'newest':
                            return b.dateAdded - a.dateAdded;
                        case 'oldest':
                            return a.dateAdded - b.dateAdded;
                        default:
                            return 0;
                    }
                });

                this.renderListings();
                this.updateResultsCount();
            }

            renderListings() {
                const container = document.getElementById('listings-container');
                if (!container) return;

                if (this.filteredListings.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="w-16 h-16 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-2">No listings found</h3>
                            <p class="text-slate-600 dark:text-slate-300">Try adjusting your filters to see more results.</p>
                        </div>
                    `;
                    return;
                }

                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageListings = this.filteredListings.slice(startIndex, endIndex);

                container.innerHTML = pageListings.map(listing => this.renderListingCard(listing)).join('');
            }

            renderListingCard(listing) {
                const isFavorite = this.favorites.includes(listing.id);
                const favoriteIcon = isFavorite ?
                    `<svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>` :
                    `<svg class="w-4 h-4 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>`;

                const badges = listing.badges.map(badge => {
                    const badgeConfig = {
                        'express-seller': { text: '🚖 Express Seller', class: 'bg-accent text-white' },
                        'hot-deal': { text: '🔥 Hot Deal', class: 'bg-orange-500 text-white' },
                        'premium': { text: '⭐ Premium', class: 'bg-purple-500 text-white' },
                        'high-volume': { text: '📈 High Volume', class: 'bg-blue-500 text-white' }
                    };
                    const config = badgeConfig[badge] || { text: badge, class: 'bg-slate-500 text-white' };
                    return `<div class="absolute top-3 right-3 ${config.class} text-xs font-bold px-2 py-1 rounded">${config.text}</div>`;
                }).join('');

                const roi = ((listing.cashFlow / listing.askingPrice) * 100).toFixed(1);

                return `
                    <div class="listing-card bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden hover:shadow-lg transition-shadow">
                        <div class="relative">
                            <img src="${listing.image}" alt="${listing.name}" class="w-full h-48 object-cover" loading="lazy">
                            ${badges}
                            <button type="button"
                                    onclick="window.enhancedMarketplace.toggleFavorite(${listing.id})"
                                    aria-label="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}"
                                    title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}"
                                    class="absolute top-3 left-3 p-2 bg-white/80 rounded-full hover:bg-white transition-all">
                                ${favoriteIcon}
                            </button>
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="bg-primary-light/20 text-primary-dark text-xs font-medium px-2 py-1 rounded">${listing.type}</span>
                                <div class="flex items-center text-sm text-slate-500 dark:text-slate-400">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    ${listing.location}
                                </div>
                            </div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-2">${listing.name}</h3>
                            <p class="text-sm text-slate-600 dark:text-slate-300 mb-3 line-clamp-2">${listing.description}</p>
                            <div class="space-y-1 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500 dark:text-slate-400">Asking Price:</span>
                                    <span class="font-semibold text-slate-900 dark:text-white">$${(listing.askingPrice / 1000).toFixed(0)}K</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500 dark:text-slate-400">Cash Flow:</span>
                                    <span class="font-semibold text-emerald-600">$${(listing.cashFlow / 1000).toFixed(0)}K/year</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500 dark:text-slate-400">ROI:</span>
                                    <span class="font-semibold text-blue-600">${roi}%</span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button type="button"
                                        onclick="window.enhancedMarketplace.openDetailsModal(${listing.id})"
                                        class="flex-1 bg-primary-dark hover:bg-primary text-white text-sm font-medium py-2 px-3 rounded-md transition-all">
                                    View Details
                                </button>
                                <button type="button"
                                        onclick="window.enhancedMarketplace.contactSeller(${listing.id})"
                                        class="bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 text-sm font-medium py-2 px-3 rounded-md transition-all">
                                    Contact
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            openDetailsModal(listingId) {
                const listing = this.listings.find(l => l.id === listingId);
                if (!listing) return;

                // Populate modal with listing data
                document.getElementById('modal-business-name').textContent = listing.name;
                document.getElementById('modal-business-location').textContent = listing.location;
                document.getElementById('modal-main-image').src = listing.image;
                document.getElementById('modal-main-image').alt = listing.name;

                // Key metrics
                document.getElementById('modal-asking-price').textContent = `$${(listing.askingPrice / 1000).toFixed(0)}K`;
                document.getElementById('modal-revenue').textContent = `$${(listing.revenue / 1000).toFixed(0)}K`;
                document.getElementById('modal-cash-flow').textContent = `$${(listing.cashFlow / 1000).toFixed(0)}K`;
                const roi = ((listing.cashFlow / listing.askingPrice) * 100).toFixed(1);
                document.getElementById('modal-roi').textContent = `${roi}%`;

                // Business details
                document.getElementById('modal-description').textContent = listing.description;
                document.getElementById('modal-business-type').textContent = listing.type;
                document.getElementById('modal-established').textContent = listing.established;
                document.getElementById('modal-employees').textContent = listing.employees;
                document.getElementById('modal-square-footage').textContent = `${listing.squareFootage.toLocaleString()} sq ft`;

                // Badges
                const badgesContainer = document.getElementById('modal-badges-container');
                const badgeConfig = {
                    'express-seller': { text: '🚖 Express Seller', class: 'bg-accent text-white' },
                    'hot-deal': { text: '🔥 Hot Deal', class: 'bg-orange-500 text-white' },
                    'premium': { text: '⭐ Premium', class: 'bg-purple-500 text-white' },
                    'high-volume': { text: '📈 High Volume', class: 'bg-blue-500 text-white' }
                };
                badgesContainer.innerHTML = listing.badges.map(badge => {
                    const config = badgeConfig[badge] || { text: badge, class: 'bg-slate-500 text-white' };
                    return `<div class="${config.class} text-xs font-bold px-3 py-1 rounded-full">${config.text}</div>`;
                }).join('');

                // Features
                const featuresContainer = document.getElementById('modal-features-container');
                featuresContainer.innerHTML = listing.features.map(feature =>
                    `<span class="bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-sm px-3 py-1 rounded-full">${feature}</span>`
                ).join('');

                // Seller information
                document.getElementById('modal-seller-name').textContent = listing.seller.name;
                document.getElementById('modal-seller-company').textContent = listing.seller.company;
                document.getElementById('modal-seller-initials').textContent = listing.seller.initials;

                // Update favorite button
                const favoriteBtn = document.getElementById('modal-favorite-btn');
                const isFavorite = this.favorites.includes(listing.id);
                favoriteBtn.dataset.listingId = listing.id;
                favoriteBtn.innerHTML = isFavorite ?
                    `<svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>` :
                    `<svg class="w-5 h-5 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>`;

                // Update action buttons
                document.getElementById('modal-contact-btn').dataset.listingId = listing.id;
                document.getElementById('modal-schedule-btn').dataset.listingId = listing.id;

                // Show modal
                const modal = document.getElementById('business-details-modal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }

            closeDetailsModal() {
                const modal = document.getElementById('business-details-modal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.style.overflow = '';
            }

            toggleFavorite(listingId) {
                const index = this.favorites.indexOf(listingId);
                if (index > -1) {
                    this.favorites.splice(index, 1);
                } else {
                    this.favorites.push(listingId);
                }

                this.saveFavorites();
                this.renderListings(); // Re-render to update heart icons

                // Update modal favorite button if modal is open
                const modalFavoriteBtn = document.getElementById('modal-favorite-btn');
                if (modalFavoriteBtn && modalFavoriteBtn.dataset.listingId == listingId) {
                    const isFavorite = this.favorites.includes(listingId);
                    modalFavoriteBtn.innerHTML = isFavorite ?
                        `<svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>` :
                        `<svg class="w-5 h-5 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>`;
                }

                // Show feedback
                const action = index > -1 ? 'removed from' : 'added to';
                this.showToast(`Business ${action} favorites!`, index > -1 ? 'info' : 'success');
            }

            loadFavorites() {
                try {
                    const saved = localStorage.getItem('marketplace-favorites');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('Error loading favorites:', error);
                    return [];
                }
            }

            saveFavorites() {
                try {
                    localStorage.setItem('marketplace-favorites', JSON.stringify(this.favorites));
                } catch (error) {
                    console.error('Error saving favorites:', error);
                }
            }

            contactSeller(listingId) {
                const listing = this.listings.find(l => l.id === listingId);
                if (!listing) return;

                // In a real application, this would open a contact form or messaging system
                this.showToast(`Contacting ${listing.seller.name} about ${listing.name}`, 'info');

                // For demo purposes, show an alert
                alert(`Contact information for ${listing.name}:\n\nSeller: ${listing.seller.name}\nCompany: ${listing.seller.company}\n\nIn a real application, this would open a secure messaging system or contact form.`);
            }

            scheduleTour(listingId) {
                const listing = this.listings.find(l => l.id === listingId);
                if (!listing) return;

                // In a real application, this would open a scheduling system
                this.showToast(`Scheduling tour for ${listing.name}`, 'info');

                // For demo purposes, show an alert
                alert(`Schedule a tour of ${listing.name}:\n\nLocation: ${listing.location}\nSeller: ${listing.seller.name}\n\nIn a real application, this would integrate with a calendar booking system.`);
            }

            updateResultsCount() {
                const resultsCount = document.getElementById('results-count');
                if (resultsCount) {
                    const total = this.filteredListings.length;
                    const start = (this.currentPage - 1) * this.itemsPerPage + 1;
                    const end = Math.min(start + this.itemsPerPage - 1, total);

                    if (total === 0) {
                        resultsCount.textContent = 'No results found';
                    } else {
                        resultsCount.textContent = `Showing ${start}-${end} of ${total} listings`;
                    }
                }
            }

            showToast(message, type = 'info') {
                // Create toast notification
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 translate-x-full`;

                // Set color based on type
                switch (type) {
                    case 'success':
                        toast.classList.add('bg-emerald-500');
                        break;
                    case 'error':
                        toast.classList.add('bg-red-500');
                        break;
                    case 'warning':
                        toast.classList.add('bg-orange-500');
                        break;
                    default:
                        toast.classList.add('bg-blue-500');
                }

                toast.textContent = message;
                document.body.appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                }, 100);

                // Animate out and remove
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }

            // ============================================================================
            // SEARCH ALERTS FUNCTIONALITY
            // ============================================================================

            /**
             * Extract current search criteria from active filters
             */
            extractCurrentSearchCriteria() {
                const criteria = {
                    search_query: this.currentFilters.search || '',
                    filters: {
                        business_types: this.currentFilters.businessTypes || [],
                        price_min: this.currentFilters.priceMin || null,
                        price_max: this.currentFilters.priceMax || null,
                        location: this.currentFilters.location !== 'All DFW Area' ? this.currentFilters.location : null,
                        revenue_min: this.currentFilters.revenue || null,
                        express_only: this.currentFilters.expressOnly || false
                    },
                    metadata: {
                        sort_by: this.currentSort,
                        page: this.currentPage,
                        items_per_page: this.itemsPerPage,
                        extracted_at: new Date().toISOString(),
                        total_results: this.filteredListings.length
                    }
                };

                // Remove empty/null filters
                Object.keys(criteria.filters).forEach(key => {
                    if (criteria.filters[key] === null ||
                        criteria.filters[key] === '' ||
                        (Array.isArray(criteria.filters[key]) && criteria.filters[key].length === 0)) {
                        delete criteria.filters[key];
                    }
                });

                return criteria;
            }

            /**
             * Show the save search alert modal
             */
            async showSaveSearchAlertModal() {
                try {
                    // Show loading state
                    const btn = document.getElementById('save-search-alert-btn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = `
                        <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Loading...
                    `;
                    btn.disabled = true;

                    // Dynamically import the save search alert modal
                    const { SaveSearchAlertModal } = await import('/src/features/search-alerts/components/save-search-alert-modal.js');

                    // Create modal instance if not exists
                    if (!this.saveSearchAlertModal) {
                        this.saveSearchAlertModal = new SaveSearchAlertModal();
                    }

                    // Extract current search criteria
                    const searchCriteria = this.extractCurrentSearchCriteria();

                    // Show the modal with current search criteria
                    this.saveSearchAlertModal.show(searchCriteria, (savedAlert) => {
                        // Success callback
                        this.showToast(`Search alert "${savedAlert.search_name}" saved successfully!`, 'success');

                        // Track analytics event
                        this.trackSearchAlertEvent('search_alert_saved', {
                            alert_name: savedAlert.search_name,
                            notification_frequency: savedAlert.notification_frequency,
                            has_filters: Object.keys(searchCriteria.filters || {}).length > 0,
                            search_query_length: searchCriteria.search_query.length
                        });
                    });

                } catch (error) {
                    console.error('❌ Error loading search alerts modal:', error);
                    this.showToast('Failed to load search alerts. Please try again.', 'error');
                } finally {
                    // Restore button state
                    const btn = document.getElementById('save-search-alert-btn');
                    btn.innerHTML = `
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5v-12h0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 0V1m0 6l4-4M9 7L5 3"/>
                        </svg>
                        Save Alert
                    `;
                    btn.disabled = false;
                }
            }

            /**
             * Track search alert analytics events
             */
            trackSearchAlertEvent(eventName, eventData) {
                try {
                    // Track with Google Analytics if available
                    if (typeof gtag !== 'undefined') {
                        gtag('event', eventName, {
                            event_category: 'search_alerts',
                            event_label: eventData.alert_name || 'unnamed_alert',
                            custom_parameters: eventData
                        });
                    }

                    // Track with custom analytics if available
                    if (window.analytics && typeof window.analytics.track === 'function') {
                        window.analytics.track(eventName, eventData);
                    }

                    console.log(`📊 Analytics: ${eventName}`, eventData);
                } catch (error) {
                    console.warn('⚠️ Analytics tracking failed:', error);
                }
            }
        }

        // Initialize enhanced marketplace
        document.addEventListener('DOMContentLoaded', function() {
            window.enhancedMarketplace = new EnhancedMarketplace();
        });
    </script>

    <!-- Load modular marketplace system -->
    <script type="module">
        import { MarketplaceService } from '../src/features/marketplace/index.js';
        import { validationUtils, formattingUtils, uiUtils, storageUtils } from '../src/shared/index.js';

        // Make services available globally for marketplace
        window.ArdonieMarketplace = {
            marketplace: MarketplaceService,
            // listings: listingService, // Not available yet
            // search: searchService, // Not available yet
            validation: validationUtils,
            formatting: formattingUtils,
            ui: uiUtils,
            storage: storageUtils
        };

        console.log('Modular marketplace system loaded');
    </script>

    <!-- Fallback for legacy marketplace scripts -->
    <script>
        setTimeout(() => {
            if (!window.ArdonieMarketplace) {
                console.warn('Modular marketplace not available, loading legacy scripts');
                const commonScript = document.createElement('script');
                commonScript.src = '../assets/js/common.js';
                document.head.appendChild(commonScript);

                const marketplaceScript = document.createElement('script');
                marketplaceScript.src = '../assets/js/marketplace-listings.js';
                document.head.appendChild(marketplaceScript);
            }
        }, 1000);
    </script>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white py-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Main Footer Content -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                <!-- Company Info -->
                <div class="lg:col-span-1">
                    <div class="text-xl font-bold text-primary-light mb-3">Ardonie Capital</div>
                    <p class="text-slate-400 text-sm mb-4 max-w-md leading-relaxed">
                        The premier marketplace for DFW auto repair shop transactions.
                        Connecting buyers and sellers through our Express Deal Package for 34-day closings.
                    </p>
                    <div class="text-slate-400 text-sm space-y-1 mb-4">
                        <div>55 9th Street, #1316</div>
                        <div>San Francisco, CA 94103</div>
                        <div>424-253-4019</div>
                    </div>
                    <div class="flex space-x-3">
                        <a href="https://twitter.com/ardoniecapital" class="text-slate-400 hover:text-white transition-colors" aria-label="Twitter">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                            </svg>
                        </a>
                        <a href="https://facebook.com/ardoniecapital" class="text-slate-400 hover:text-white transition-colors" aria-label="Facebook">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        <a href="https://linkedin.com/company/ardoniecapital" class="text-slate-400 hover:text-white transition-colors" aria-label="LinkedIn">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </a>
                    </div>
                </div>

                <!-- Navigation Links -->
                <div class="lg:col-span-4">
                    <!-- Top Row - 4 Columns -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Main Pages -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Main Pages</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../about.html" class="text-slate-400 hover:text-white transition-colors text-sm">About Us</a></li>
                                <li><a href="../blog/index.html" class="text-slate-400 hover:text-white transition-colors text-sm">Blog</a></li>
                                <li><a href="../careers.html" class="text-slate-400 hover:text-white transition-colors text-sm">Careers</a></li>
                                <li><a href="../contact.html" class="text-slate-400 hover:text-white transition-colors text-sm">Contact</a></li>
                                <li><a href="../index.html" class="text-slate-400 hover:text-white transition-colors text-sm">Home</a></li>
                                <li><a href="../how-it-works.html" class="text-slate-400 hover:text-white transition-colors text-sm">How It Works</a></li>
                                <li><a href="../for-sellers.html" class="text-slate-400 hover:text-white transition-colors text-sm">For Sellers</a></li>
                            </ul>
                        </div>

                        <!-- Express Programs -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Express Programs</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../marketplace/listings.html" class="text-slate-400 hover:text-white transition-colors text-sm">Browse Listings</a></li>
                                <li><a href="../express-deal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Express Deal</a></li>
                                <li><a href="../for-buyers.html" class="text-slate-400 hover:text-white transition-colors text-sm">For Buyers</a></li>
                                <li><a href="../for-sellers.html" class="text-slate-400 hover:text-white transition-colors text-sm">For Sellers</a></li>
                                <li><a href="../matchmaking/matches.html" class="text-slate-400 hover:text-white transition-colors text-sm">Matchmaking</a></li>
                                <li><a href="../prelaunch-express.html" class="text-slate-400 hover:text-white transition-colors text-sm">Prelaunch Express</a></li>
                            </ul>
                        </div>

                        <!-- Professional Services -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Professional Services</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../vendor-portal/accounting-firms.html" class="text-slate-400 hover:text-white transition-colors text-sm">Accounting Firms</a></li>
                                <li><a href="../documents/vendor-accounting.html" class="text-slate-400 hover:text-white transition-colors text-sm">Accounting Partners</a></li>
                                <li><a href="../vendor-portal/financial-institutions.html" class="text-slate-400 hover:text-white transition-colors text-sm">Financial Institutions</a></li>
                                <li><a href="../documents/vendor-financial.html" class="text-slate-400 hover:text-white transition-colors text-sm">Financial Partners</a></li>
                                <li><a href="../vendor-portal/legal-firms.html" class="text-slate-400 hover:text-white transition-colors text-sm">Legal Firms</a></li>
                                <li><a href="../documents/vendor-legal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Legal Partners</a></li>
                            </ul>
                        </div>

                        <!-- User Portals -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">User Portals</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../portals/accountant-portal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Accountant Portal</a></li>
                                <li><a href="../portals/attorney-portal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Attorney Portal</a></li>
                                <li><a href="../portals/buyer-portal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Buyer Dashboard/Portal</a></li>
                                <li><a href="../portals/seller-portal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Seller Dashboard/Portal</a></li>
                                <li><a href="../portals/lender-portal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Lender Portal</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Bottom Row - 4 Columns -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Business Documents -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Business Documents</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../documents/business-plan.html" class="text-slate-400 hover:text-white transition-colors text-sm">Business Plan</a></li>
                                <li><a href="../documents/pitch-deck-fi.html" class="text-slate-400 hover:text-white transition-colors text-sm">FI Pitch Deck</a></li>
                                <li><a href="../documents/pitch-deck-legal.html" class="text-slate-400 hover:text-white transition-colors text-sm">Legal Pitch Deck</a></li>
                                <li><a href="../documents/marketing-plan.html" class="text-slate-400 hover:text-white transition-colors text-sm">Marketing Plan</a></li>
                                <li><a href="../documents/one-page-pitch.html" class="text-slate-400 hover:text-white transition-colors text-sm">One Page Pitch</a></li>
                            </ul>
                        </div>

                        <!-- Strategy & Planning -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Strategy & Planning</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../documents/company-strategy.html" class="text-slate-400 hover:text-white transition-colors text-sm">Company Strategy</a></li>
                                <li><a href="../documents/financial-projections.html" class="text-slate-400 hover:text-white transition-colors text-sm">Financial Projections</a></li>
                                <li><a href="../documents/founding-member.html" class="text-slate-400 hover:text-white transition-colors text-sm">Founding Member</a></li>
                                <li><a href="../documents/nda.html" class="text-slate-400 hover:text-white transition-colors text-sm">NDA</a></li>
                                <li><a href="../documents/templates.html" class="text-slate-400 hover:text-white transition-colors text-sm">Templates</a></li>
                            </ul>
                        </div>

                        <!-- Tools & Resources -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Tools & Resources</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../tools/due-diligence-checklist.html" class="text-slate-400 hover:text-white transition-colors text-sm">Due Diligence</a></li>
                                <li><a href="../education/guides.html" class="text-slate-400 hover:text-white transition-colors text-sm">Learning Center</a></li>
                                <li><a href="../funding/loan-calculator.html" class="text-slate-400 hover:text-white transition-colors text-sm">Loan Calculator</a></li>
                                <li><a href="../tools/valuation.html" class="text-slate-400 hover:text-white transition-colors text-sm">Valuation Tool</a></li>
                            </ul>
                        </div>

                        <!-- Account & Support -->
                        <div>
                            <h3 class="text-sm font-semibold mb-3 text-white">Account & Support</h3>
                            <ul class="space-y-1.5">
                                <li><a href="../contact.html" class="text-slate-400 hover:text-white transition-colors text-sm">Contact Support</a></li>
                                <li><a href="../auth/login.html" class="text-slate-400 hover:text-white transition-colors text-sm">Login</a></li>
                                <li><a href="../auth/register.html" class="text-slate-400 hover:text-white transition-colors text-sm">Register</a></li>
                                <li><span class="text-slate-400 text-sm">424-253-4019</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="border-t border-slate-800 mt-6 pt-6 flex flex-col md:flex-row justify-between items-center">
                <p class="text-slate-400 text-sm">
                    © 2024 Ardonie Capital. All rights reserved. Closing DFW auto repair deals in 34 days.
                </p>
                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-6 mt-4 md:mt-0">
                    <a href="../terms-of-service.html" class="text-slate-400 hover:text-white transition-colors text-sm">Terms of Service</a>
                    <a href="../cookie-policy.html" class="text-slate-400 hover:text-white transition-colors text-sm">Cookie Policy</a>
                    <a href="../privacy-policy.html" class="text-slate-400 hover:text-white transition-colors text-sm">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Load Navigation Component -->
    <script src="../components/main-navigation.js"></script>
    <script src="../components/admin-navigation.js"></script>

    <!-- Express Listings Supabase Integration -->
    <script src="express-listings-supabase-integration.js"></script>
</body>
</html>
